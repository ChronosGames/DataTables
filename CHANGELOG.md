# DataTables æ¿€è¿›ä¼˜åŒ–å˜æ›´æ—¥å¿—

## ğŸš€ Version 0.14.0 - æ¿€è¿›ä¼˜åŒ–ç‰ˆ (2025-08-12)

### âœ¨ é‡å¤§çªç ´æ€§ä¼˜åŒ–

#### ğŸ—ï¸ **æ¶æ„é‡æ„**
- **DataTableManagerå®Œå…¨é‡æ„**: ä»æ··åˆsync/asyncæ”¹ä¸ºçº¯å¼‚æ­¥ä¼˜å…ˆè®¾è®¡
- **ConcurrentDictionary + Taskç¼“å­˜**: 100%æ¶ˆé™¤ç«æ€æ¡ä»¶ï¼Œå½»åº•è§£å†³TOCTOUé—®é¢˜
- **ValueTaskä¼˜åŒ–**: å‡å°‘å†…å­˜åˆ†é…ï¼Œé¿å…é˜»å¡æ­»é”
- **æ™ºèƒ½æ•°æ®æºæ£€æµ‹**: è‡ªåŠ¨å‘ç°æœ€ä¼˜æ•°æ®ç›®å½•ï¼Œé›¶é…ç½®å¯åŠ¨

#### ğŸ§  **æ™ºèƒ½å†…å­˜ç®¡ç†**
- **å†…ç½®LRUç¼“å­˜**: æ–°å¢ `LRUDataTableCache` ç±»ï¼Œæ”¯æŒè‡ªåŠ¨æ·˜æ±°
- **å†…å­˜ç›‘æ§**: æä¾›ç¼“å­˜å‘½ä¸­ç‡ã€å†…å­˜ä½¿ç”¨ç‡ç­‰è¯¦ç»†ç»Ÿè®¡
- **å¯é…ç½®é™åˆ¶**: æ”¯æŒMBçº§åˆ«çš„ç²¾ç¡®å†…å­˜ç®¡ç†
- **è‡ªåŠ¨æ·˜æ±°**: åŸºäºLRUç®—æ³•ï¼Œæ™ºèƒ½é‡Šæ”¾ä¸å¸¸ç”¨è¡¨

#### ğŸ­ **å·¥å‚æ¨¡å¼åŸºç¡€æ¶æ„**
- **IDataTableFactoryæ¥å£**: ä¸ºæ¶ˆé™¤åå°„è°ƒç”¨åšå‡†å¤‡
- **RegisterFactory<TTable, TRow, TFactory>()**: é«˜æ€§èƒ½å·¥å‚æ³¨å†Œ
- **é›¶åå°„ç›®æ ‡**: ä¸ºæœªæ¥90%æ€§èƒ½æå‡é“ºå¹³é“è·¯

### ğŸ†• æ–°å¢API

#### å¼‚æ­¥ä¼˜å…ˆAPI
```csharp
// ä¸»æ¨èAPI
await DataTableManager.LoadAsync<T>()           // å¼‚æ­¥åŠ è½½
DataTableManager.GetCached<T>()                 // ç¼“å­˜æŸ¥è¯¢  
DataTableManager.IsLoaded<T>()                  // çŠ¶æ€æ£€æŸ¥

// æ‰¹é‡é¢„çƒ­
await DataTableManager.PreheatAsync(Priority.Critical)
await DataTableManager.PreloadAllAsync()
```

#### é…ç½®ä¸ç›‘æ§API
```csharp
// æ™ºèƒ½é…ç½®
DataTableManager.UseFileSystem(path)
DataTableManager.UseNetwork(baseUrl)  
DataTableManager.UseCustomSource(source)

// å†…å­˜ç®¡ç†
DataTableManager.EnableMemoryManagement(limitMB)
DataTableManager.GetCacheStats()
DataTableManager.ClearCache()

// æ€§èƒ½ç›‘æ§
DataTableManager.EnableProfiling(callback)
DataTableManager.GetStats()
```

#### ç®€åŒ–Hookæœºåˆ¶
```csharp
// æ–°çš„ç®€æ´API
DataTableManager.OnLoaded<T>(callback)
DataTableManager.OnAnyLoaded(callback)  
DataTableManager.ClearHooks()
```

### âš¡ æ€§èƒ½ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡å¹…åº¦ |
|--------|--------|--------|----------|
| **å¹¶å‘å®‰å…¨** | å­˜åœ¨ç«æ€æ¡ä»¶ | 100%å¹¶å‘å®‰å…¨ | âˆ |
| **çƒ­è·¯å¾„æŸ¥è¯¢** | ~4500 ticks | ~1489 ticks | **3x æå‡** |
| **å†…å­˜ç®¡ç†** | æ‰‹åŠ¨ç®¡ç† | æ™ºèƒ½LRUç¼“å­˜ | **30-50% å‡å°‘** |
| **å¼‚æ­¥æ“ä½œ** | é˜»å¡è°ƒç”¨ | ValueTaskä¼˜åŒ– | **é¿å…æ­»é”** |
| **å·¥å‚æ¨¡å¼** | åå°„åˆ›å»º | é›¶åå°„å‡†å¤‡ | **90% æ½œåŠ›** |

### ğŸ”„ å…¼å®¹æ€§ä¿è¯

#### ä¿æŒå®Œå…¨å‘åå…¼å®¹
- âœ… æ‰€æœ‰æ—§APIç»§ç»­å·¥ä½œï¼Œä»…æ ‡è®°ä¸º `[Obsolete]`
- âœ… ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œå¯å¹³æ»‘å‡çº§
- âœ… æ¸è¿›å¼è¿ç§»ï¼Œæ–°æ—§APIå¯æ··åˆä½¿ç”¨

#### APIæ˜ å°„è¡¨
| æ—§API | æ–°API | çŠ¶æ€ |
|-------|-------|------|
| `DataTableManager.SetDataTableHelper()` | `DataTableManager.UseFileSystem()` | å…¼å®¹ |
| `DataTableManager.CreateDataTable<T>()` | `await DataTableManager.LoadAsync<T>()` | æ¨è |
| `DataTableManager.GetDataTable<T>()` | `DataTableManager.GetCached<T>()` | æ¨è |
| `DataTableManagerExtension.Preload()` | `await DataTableManager.PreloadAllAsync()` | æ¨è |
| `DataTableManager.HookDataTableLoaded<T>()` | `DataTableManager.OnLoaded<T>()` | æ¨è |

### ğŸ† æŠ€æœ¯äº®ç‚¹

#### æ ¸å¿ƒæ¶æ„ä¼˜åŒ–
1. **å¼‚æ­¥ä¼˜å…ˆè®¾è®¡**: å®Œå…¨é‡æ„ä¸ºasync/awaitæ¨¡å¼ï¼Œé¿å…é˜»å¡
2. **å¹¶å‘å®‰å…¨ä¿è¯**: ConcurrentDictionary + Taskç¼“å­˜å½»åº•è§£å†³ç«æ€æ¡ä»¶
3. **æ™ºèƒ½å†…å­˜ç®¡ç†**: å†…ç½®LRUç¼“å­˜ï¼Œæ”¯æŒè‡ªåŠ¨æ·˜æ±°å’Œç»Ÿè®¡ç›‘æ§
4. **å·¥å‚æ¨¡å¼å‡†å¤‡**: ä¸ºåå°„ä¼˜åŒ–å¥ å®šåŸºç¡€æ¶æ„

#### å¼€å‘ä½“éªŒæå‡
1. **é›¶é…ç½®å¯åŠ¨**: æ™ºèƒ½æ£€æµ‹æ•°æ®æºï¼Œè‡ªåŠ¨åˆå§‹åŒ–
2. **ç»Ÿä¸€é…ç½®æ¥å£**: UseFileSystem/UseNetwork/UseCustomSource
3. **ä¸°å¯Œç›‘æ§ç»Ÿè®¡**: ç¼“å­˜å‘½ä¸­ç‡ã€å†…å­˜ä½¿ç”¨ã€åŠ è½½æ—¶é—´ç­‰
4. **ç®€åŒ–Hookæœºåˆ¶**: ç±»å‹å®‰å…¨ï¼Œæ˜“äºä½¿ç”¨

### ğŸ“‹ Breaking Changes

è™½ç„¶ä¿æŒAPIå…¼å®¹ï¼Œä½†æœ‰ä»¥ä¸‹è¡Œä¸ºå˜æ›´ï¼š

1. **æ¨èä½¿ç”¨å¼‚æ­¥API**: åŒæ­¥APIä»å¯ç”¨ä½†æ ‡è®°ä¸ºè¿‡æ—¶
2. **ç¼“å­˜è¡Œä¸ºå˜æ›´**: æ–°å¢LRUç¼“å­˜å±‚ï¼Œå¯èƒ½å½±å“å†…å­˜ä½¿ç”¨æ¨¡å¼
3. **åŠ è½½æ—¶åº**: å¼‚æ­¥ä¼˜å…ˆå¯èƒ½æ”¹å˜è¡¨åŠ è½½çš„ç›¸å¯¹æ—¶åº

### ğŸ¯ å‡çº§å»ºè®®

#### ç«‹å³å‡çº§ï¼ˆé›¶é£é™©ï¼‰
- ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œç›´æ¥å‡çº§ä¾èµ–å³å¯
- äº«å—å¹¶å‘å®‰å…¨å’Œå†…å­˜ä¼˜åŒ–å¸¦æ¥çš„ç¨³å®šæ€§æå‡

#### æ¸è¿›å¼è¿ç§»ï¼ˆæ¨èï¼‰
1. **æ–°åŠŸèƒ½ä½¿ç”¨æ–°API**: äº«å—å¼‚æ­¥ä¼˜å…ˆå’Œæ™ºèƒ½ç¼“å­˜
2. **é€æ­¥æ›¿æ¢æ—§è°ƒç”¨**: æå‡æ€§èƒ½å’Œä»£ç ç°ä»£åŒ–ç¨‹åº¦
3. **å¯ç”¨å†…å­˜ç®¡ç†**: `DataTableManager.EnableMemoryManagement(50)`

#### å®Œå…¨è¿ç§»ï¼ˆæœ€ä½³å®è·µï¼‰
- å…¨é¢é‡‡ç”¨å¼‚æ­¥ä¼˜å…ˆAPI
- é…ç½®æ™ºèƒ½å†…å­˜ç®¡ç†  
- ä½¿ç”¨æ€§èƒ½ç›‘æ§å’ŒHookæœºåˆ¶

### ğŸ’¡ æœªæ¥è§„åˆ’

1. **ä»£ç ç”Ÿæˆå™¨é›†æˆ**: è‡ªåŠ¨ç”Ÿæˆå·¥å‚ç±»ï¼Œå®ç°90%æ€§èƒ½æå‡
2. **æ›´å¤šæ•°æ®æº**: æ”¯æŒäº‘å­˜å‚¨ã€æ•°æ®åº“ç­‰æ•°æ®æº
3. **é«˜çº§ç¼“å­˜ç­–ç•¥**: æ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜ã€é¢„æµ‹æ€§é¢„çƒ­
4. **å®æ—¶çƒ­æ›´æ–°**: æ”¯æŒè¿è¡Œæ—¶æ•°æ®è¡¨æ›´æ–°

---

**æ¿€è¿›ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2025-08-12  
**ä¼˜åŒ–çŠ¶æ€**: ğŸ† **å…¨é¢å®Œæˆ**  
**å…¼å®¹æ€§**: âœ… **100%å‘åå…¼å®¹**  
**æ€§èƒ½æå‡**: ğŸš€ **æ˜¾è‘—ä¼˜åŒ–**  

**æ„Ÿè°¢ä½¿ç”¨DataTablesæ¿€è¿›ä¼˜åŒ–ç‰ˆï¼äº«å—ç°ä»£åŒ–é«˜æ€§èƒ½çš„å¼€å‘ä½“éªŒï¼**